---
import NavLink from './NavLink.astro';
import ThemeToggle from './ThemeToggle.astro';
import siteConfig from '#data/site-config';

const navLinks = siteConfig.headerNavLinks ?? [];
---

<header id="site-header">
	<a href="/" id="logo"><em>Amare</em></a>
	<nav aria-label="Primary Navigation">
		<button id="nav-menu-button" aria-label="Open Menu" aria-expanded="false" aria-controls="nav-links">
			<span class="icon"></span>
		</button>
		<ul id="nav-links">
			{
				navLinks.map((link) => (
					<li>
						<NavLink href={link.href}>{link.text}</NavLink>
					</li>
				))
			}
			<li>
				<ThemeToggle />
			</li>
		</ul>
	</nav>
</header>

<style is:global>
	#site-header {
		position: fixed;
		top: 0;
		width: 100%;
		padding: 2rem 5%;
		display: flex;
		justify-content: space-between;
		align-items: center;
		background: linear-gradient(to bottom, var(--bg-main) 70%, transparent);
		z-index: 100;
		transition: all 0.3s ease;

		&.scrolled {
			padding: 1rem 5%;
			background: rgb(from var(--bg-main) r g b / 0.9);
			backdrop-filter: blur(10px);
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
		}
	}

	#logo {
		font-family: 'Crimson Pro', serif;
		font-size: 1.5rem;
		font-weight: 300;
		letter-spacing: 0.02em;
		text-decoration: none;
		color: var(--text-main);
	}

	#nav-links {
		list-style: none;
		display: flex;
		gap: 2rem;
	}

	#nav-menu-button {
		display: none;
		position: relative;
		z-index: 30;
		cursor: pointer;
		margin-left: -4px;
		align-items: center;
		justify-content: center;
		width: 2rem;
		height: 2rem;

		& > .icon {
			position: relative;
			width: 1.5rem;
			height: 1.5px;
			background-color: currentColor;
			transition: width 0.1s cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
		}
	}

	@media (width < 768px) {
		#nav-menu-button {
			display: flex;

			& > .icon {
				&::before,
				&::after {
					content: '';
					position: absolute;
					top: 0;
					left: 50%;
					width: 1.5rem;
					height: 1.5px;
					background-color: currentColor;
					transform-origin: center;
					translate: -50%;
					transition:
						rotate 0.2s cubic-bezier(0.4, 0, 0.2, 1),
						margin 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.2s;
				}
				&::before {
					margin-top: -6px;
				}
				&::after {
					margin-top: 6px;
				}
			}

			&.active > .icon {
				width: 0;
				transition: width 0.1s cubic-bezier(0.4, 0, 0.2, 1);

				&::before,
				&::after {
					margin-top: 0;
					transition:
						margin 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s,
						rotate 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
				}
				&::before {
					rotate: 45deg;
				}
				&::after {
					rotate: -45deg;
				}
			}
		}

		#nav-links {
			position: fixed;
			top: 0;
			right: -100%;
			height: 100vh;
			width: 70%;
			max-width: 300px;
			background: var(--bg-main);
			flex-direction: column;
			padding: 6rem 2rem 2rem;
			gap: 2rem;
			box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
			transition: right 0.4s ease;
			z-index: 20;

			& a {
				font-size: 1.25rem;
			}

			&.active {
				right: 0;
			}
		}
	}
</style>

<script>
	const header = document.querySelector('header');
	const menuToggle = document.getElementById('nav-menu-button');
	const navLinks = document.getElementById('nav-links');

	window.addEventListener('scroll', () => {
		if (window.scrollY > 100) {
			header?.classList.add('scrolled');
		} else {
			header?.classList.remove('scrolled');
		}
	});

	function toggleMenu() {
		menuToggle?.addEventListener('click', () => {
			const isActive = menuToggle.getAttribute('aria-expanded') === 'true';
			menuToggle.setAttribute('aria-expanded', `${isActive}`);
			menuToggle.setAttribute('aria-label', isActive ? 'Open Menu' : 'Close Menu');
			menuToggle.classList.toggle('active');
			navLinks?.classList.toggle('active');
		});
	}

	toggleMenu();
	document.addEventListener('astro:after-swap', toggleMenu);
</script>
