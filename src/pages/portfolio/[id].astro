---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import ProjectPreview from '#components/ProjectPreview.astro';
import BaseLayout from '#layouts/Layout.astro';
import { byDateDesc } from '#lib/utils';

export async function getStaticPaths() {
	const projects = (await getCollection('projects')).sort(byDateDesc);
	const projectCount = projects.length;
	return projects.map((project, index) => ({
		params: { id: project.id },
		props: {
			project,
			prevProject: index + 1 !== projectCount ? projects[index + 1] : null,
			nextProject: index !== 0 ? projects[index - 1] : null
		}
	}));
}

type Props = {
	project: CollectionEntry<'projects'>;
	prevProject: CollectionEntry<'projects'>;
	nextProject: CollectionEntry<'projects'>;
};

const { project, prevProject, nextProject } = Astro.props;
const { title, description, seo } = project.data;
const { Content } = await render(project);
---

<BaseLayout title={seo?.title ?? title} description={seo?.description ?? description} image={seo?.image} pageType="article">
	<article>
		<header>
			<h1>{title}</h1>
		</header>
		<section class="prose sm:prose-lg max-w-none">
			<Content />
		</section>
	</article>
	{
		(prevProject || nextProject) && (
			<nav id="article-series">
				<h2>View Next</h2>
				{nextProject && <ProjectPreview project={nextProject} headingLevel="h3" />}
				{prevProject && <ProjectPreview project={prevProject} headingLevel="h3" />}
			</nav>
		)
	}
</BaseLayout>

<style is:global>
	@import '#styles/article.css';
</style>
